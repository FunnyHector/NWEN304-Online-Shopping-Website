<html>
    <% include components/head.ejs %>
    <body>
        <% include components/menu_and_heading.ejs %>
        <div class="container content">
            <h1>Order #<%= order_id %></h1>
            <div>
                <%
                var date = new Date(order_time);
                var end = 'AM';
                var hour = date.getUTCHours();
                if(hour >= 12){
                    end = 'PM';
                }
                if(hour > 12){
                    hour = hour - 12;
                }
                var minute = date.getMinutes();
                if(minute < 10){
                    minute = '0' + minute;
                }
                var total = (totalPrice + "").split('.');
                var dollar = total[0];
                var cent = '00';
                if(total.length == 2){
                    cent = total[1];
                    if(total[1] < 10){
                        cent = cent + '0';
                    }
                }
                %>
                <p>Date Ordered: <%= date.getDate() %>/<%= date.getMonth() + 1 %>/<%= date.getFullYear() %></p>
                <p>Time Ordered: <%= hour %>:<%= minute %> <%= end %></p>
                <p>Total Price: $<%= dollar %>.<%= cent %></p>
                <table class="table">
                    <thead>
                    <tr>
                        <th>Album Cover</th>
                        <th>Title</th>
                        <th>Quantity</th>
                        <th>Price</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    <% for (let album of albums) { %>
                    <tr>
                        <td><img src="/image/albums/small/<%= album.album_id %>" width="30" alt="album cover image"/></td>
                        <td><a href="/item/<%= album.id %>"><%= album.title %></a></td>
                        <td><%= album.quantity %></td>
                        <td><%= album.price %></td>
                        <td>
                            <span data-album_id="<%= album.item_id %>" data-toggle="modal" data-target="#confirm-modal" class="glyphicon glyphicon-remove action remove" aria-hidden="true"></span>
                        </td>
                    </tr>
                    <% } %>
                    </tbody>
                </table>
                <a href="/manage/orders" class="btn btn-primary btn-large" role="button">Cancel</a>
            </div>
            <div id="confirm-modal" class="modal fade" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-sm" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4>Confirm Delete</h4>
                        </div>
                        <div class="modal-body">
                            <p>Are you sure you want to remove this album from the order?</p>
                        </div>
                        <div class="modal-footer">
                            <button data-yes="" data-dismiss="modal" id="confirm-delete" type="button" class="btn btn-default">Yes</button>
                            <button data-dismiss="modal" type="button" class="btn btn-default">No</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            $('#confirm-modal').on('show.bs.modal', function(event){
                var id = $(event.relatedTarget).data('album_id');
                $('#confirm-delete').attr('data-yes', id);
            });

            $('#confirm-delete').click(function(event){
                var id = $(this).attr('data-yes');
                $.ajax({
                    url: '/manage/remove/item/' + id,
                    type: 'post',
                    success: function(){
                        location.reload();
                    }
                })
            });
        </script>
    </body>
</html>

